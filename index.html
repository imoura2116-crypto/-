<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>暗記帳</title>
<style>
  body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f5f5f5; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; }
  #question, #answer { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); max-width: 90%; margin: 20px 0; font-size: 1.2em; text-align: center; }
  #answer { background: #4cafef; color: white; display: none; }
  #progress { margin-top: 5px; font-size: 0.9em; color: #555; }
  select, label { margin-top: 10px; }
</style>
</head>
<body>
<select id="csvSelect"></select>
<label><input type="checkbox" id="randomOrder"> ランダム出題</label>
<div id="question">問題がここに表示されます</div>
<div id="answer"></div>
<div id="progress"></div>
<script>
let qaList = [];
let currentIndex = 0;

async function loadCSVList() {
  try {
    const res = await fetch('csv/list.json?_=' + Date.now());
    const list = await res.json();
    const select = document.getElementById('csvSelect');
    list.forEach(file => {
      const opt = document.createElement('option');
      opt.value = file;
      opt.textContent = file;
      select.appendChild(opt);
    });
    select.onchange = () => loadCSV(select.value);
    if (list.length > 0) loadCSV(list[0]);
  } catch (e) {
    console.error('リスト取得失敗:', e);
  }
}

async function loadCSV(path) {
  const res = await fetch('csv/' + path + '?_=' + Date.now());
  const text = await res.text();
  qaList = text.trim().split(/\r?\n/).map(line => {
    const [q, a] = line.split(',');
    return {q, a};
  });
  if (document.getElementById('randomOrder').checked) shuffleQuestions();
  currentIndex = 0;
  showQuestion();
}

function shuffleQuestions() {
  for (let i = qaList.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [qaList[i], qaList[j]] = [qaList[j], qaList[i]];
  }
}

function showQuestion() {
  document.getElementById('question').textContent = qaList[currentIndex].q;
  document.getElementById('answer').style.display = 'none';
  document.getElementById('progress').textContent = `${currentIndex + 1} / ${qaList.length}問`;
}

document.body.addEventListener('click', () => {
  const ansDiv = document.getElementById('answer');
  if (ansDiv.style.display === 'none') {
    ansDiv.textContent = qaList[currentIndex].a;
    ansDiv.style.display = 'block';
  } else {
    if (currentIndex < qaList.length - 1) {
      currentIndex++;
    } else {
      currentIndex = 0;
    }
    showQuestion();
  }
});

document.body.addEventListener('touchstart', handleTouchStart, false);
document.body.addEventListener('touchend', handleTouchEnd, false);
let xDown = null;
function handleTouchStart(evt) { xDown = evt.touches[0].clientX; }
function handleTouchEnd(evt) {
  if (!xDown) return;
  let xUp = evt.changedTouches[0].clientX;
  let xDiff = xDown - xUp;
  if (Math.abs(xDiff) > 50) {
    if (xDiff > 0 && currentIndex < qaList.length - 1) {
      currentIndex++;
    } else if (xDiff < 0 && currentIndex > 0) {
      currentIndex--;
    }
    showQuestion();
  }
  xDown = null;
}

loadCSVList();
</script>
</body>
</html>
