<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CSV一問一答</title>
<style>
  body { font-family: sans-serif; text-align: center; padding: 10px; }
  #question { font-size: 1.2em; margin: 20px 0; }
  #answer { font-size: 1.2em; margin: 20px 0; display: none; }
  button { padding: 10px; margin: 5px; font-size: 1em; }
  #progress { margin: 10px 0; font-size: 0.9em; color: #555; }
</style>
</head>
<body>
<select id="fileSelect"></select>
<div id="progress"></div>
<div id="question"></div>
<div id="answer"></div>
<button id="showAnswer">答えを表示</button>
<script>
let data = [], current = 0, order = [];

async function loadList(){
  const res = await fetch('csv/list.json?_=' + Date.now());
  const list = await res.json();
  const sel = document.getElementById('fileSelect');
  list.forEach(f => {
    const opt = document.createElement('option');
    opt.value = f; opt.textContent = f; sel.appendChild(opt);
  });
  sel.onchange = () => loadCSV(sel.value);
  if(list.length) loadCSV(list[0]);
}

async function loadCSV(file){
  const res = await fetch(file);
  const text = await res.text();
  data = text.split(/\r?\n/).filter(l => l.trim()).map(l => l.split(','));
  order = [...Array(data.length).keys()];
  shuffle(order);
  current = 0;
  showQuestion();
}

function showQuestion(){
  if(data.length===0) return;
  document.getElementById('question').textContent = data[order[current]][0];
  document.getElementById('answer').style.display = 'none';
  document.getElementById('answer').textContent = data[order[current]][1] || '';
  document.getElementById('progress').textContent = `${current+1} / ${data.length}問`;
}

document.getElementById('showAnswer').onclick = () => {
  const ans = document.getElementById('answer');
  ans.style.display = ans.style.display==='none' ? 'block' : 'none';
};

document.addEventListener('keydown', e => {
  if(e.key==='ArrowRight') next();
  if(e.key==='ArrowLeft') prev();
});

document.addEventListener('touchstart', handleTouchStart, false);
document.addEventListener('touchend', handleTouchEnd, false);
let xDown = null;
function handleTouchStart(e){ xDown = e.touches[0].clientX; }
function handleTouchEnd(e){
  if(!xDown) return;
  let xUp = e.changedTouches[0].clientX;
  let diff = xDown - xUp;
  if(diff>50) next();
  else if(diff<-50) prev();
  xDown = null;
}

function next(){ if(current < data.length-1){ current++; showQuestion(); } }
function prev(){ if(current > 0){ current--; showQuestion(); } }

function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
}

loadList();
</script>
</body>
</html>
